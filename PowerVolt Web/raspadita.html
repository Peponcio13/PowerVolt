<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PowerVolt ‚Äì Raspadita (l√≠neas punteadas)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">



<!-- --- BLOQUE: Bot√≥n "Volver a P√°gina Principal" (Pegar entero) --- -->
<style>
  /* Variables (si ya las ten√©s en la p√°gina no hay problema repetirlas) */
  :root{
    --neon-green: #00ff66;
    --electric-blue: #00baff;
    --bright-orange: #ff6a00;
    --ink: #0b0f14;
    --ink-2: #0f1621;
    --white: #ffffff;
    --muted: #9aa7b2;

    --radius: 16px;
    --shadow: 0 20px 40px rgba(0,0,0,0.35);
    --glow: 0 0 24px rgba(0,255,102,0.45), 0 0 48px rgba(0,186,255,0.25);
    --speed: 420ms;
  }

  /* Contenedor del bloque (centrado y con algo de padding) */
  .pv-back-block {
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 18px 0;
    box-sizing: border-box;
  }

  /* Copia fiel de .btn (estilos iguales a los de tu plantilla) */
  .pv-back-block .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 14px 22px;
    border-radius: 999px;
    border: 2px solid transparent;
    background: linear-gradient(135deg, var(--neon-green), var(--electric-blue));
    color: #071015;
    font-weight: 800;
    letter-spacing: 0.4px;
    text-decoration: none;
    position: relative;
    box-shadow: var(--glow);
    transform: translateZ(0);
    transition: transform var(--speed) ease, box-shadow var(--speed) ease, filter var(--speed) ease;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  .pv-back-block .btn:hover {
    transform: translateY(-2px) scale(1.03);
    filter: brightness(1.05);
    box-shadow: 0 0 0 4px rgba(255,255,255,0.05), var(--glow);
  }

  .pv-back-block .btn:active {
    transform: translateY(0) scale(0.98);
  }

  /* Variante outline por si la quer√©s usar */
  .pv-back-block .btn-outline {
    background: transparent;
    color: var(--white);
    border-color: rgba(255,255,255,0.18);
  }
  .pv-back-block .btn-outline:hover {
    border-color: var(--electric-blue);
    box-shadow: 0 0 0 4px rgba(0,186,255,0.12);
  }

  /* Responsivo: en pantallas chicas el bot√≥n ocupa todo el ancho */
  @media (max-width: 620px) {
    .pv-back-block .btn { width: 92%; justify-content: center; }
  }
</style>

<!-- HTML: bot√≥n listo para pegar -->
<div class="pv-back-block" role="navigation" aria-label="Volver a la p√°gina principal">
  <a href="index.html"
     class="btn"
     role="button"
     aria-label="Volver a la p√°gina principal">
    ‚¨Ö Volver a la p√°gina principal
  </a>
</div>
<!-- --- FIN BLOQUE --- -->


  
  <style>
    :root{
      --pv-neon:#00ff66;
      --pv-blue:#00baff;
      --pv-muted:#9aa7b2;
      --pv-guides: rgba(0,255,102,0.22);
      --pv-card-bg: linear-gradient(180deg,#071015,#0d1720);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#0b0f14,#0f1621);color:#fff;}
    .pv-container{width:min(1100px,94%);margin:0 auto;padding:56px 0;text-align:center;}
    .pv-ticket{max-width:820px;margin:0 auto;background:var(--pv-card-bg);padding:18px;border-radius:18px;box-shadow:0 16px 44px rgba(0,0,0,0.6);position:relative;color:#fff;}
    .pv-winning-figures{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px;border-radius:12px;background:linear-gradient(90deg, rgba(0,0,0,0.35), rgba(255,255,255,0.02));margin-bottom:14px;}
    .wins{display:flex;gap:10px}
    .win-fig{font-size:26px;background:linear-gradient(135deg,var(--pv-neon),var(--pv-blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .pv-grid-wrap{position:relative;}
    .pv-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .pv-cell{background:linear-gradient(180deg, rgba(0,0,0,0.4), rgba(255,255,255,0.02));border-radius:8px;aspect-ratio:1/1;display:grid;place-items:center;font-size:20px;font-weight:800;color:var(--pv-muted);position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.04);}
    .pv-fig{font-size:28px;pointer-events:none;user-select:none}

    .pv-scratch-canvas{
      position:absolute;
      left:12px; right:12px;
      top:12px; bottom:12px;
      border-radius:10px;
      cursor:crosshair;
      touch-action:none;
      display:block;
      z-index:20;
      pointer-events:auto;
      background: transparent;
    }
    .pv-footer{margin-top:14px;display:flex;flex-direction:column;align-items:center;gap:8px}
    .pv-status{color:var(--pv-muted);margin:0;font-weight:600}
    .pv-actions{display:flex;gap:10px;margin-top:6px}
    .pv-btn{border:none;padding:10px 14px;border-radius:999px;font-weight:800;cursor:pointer;background:linear-gradient(135deg,var(--pv-neon),var(--pv-blue));color:#071015}
    .pv-btn-retry{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}
    .pv-modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,0.6);z-index:9999}
    .pv-modal[aria-hidden="false"]{display:grid}
    .pv-modal-inner{width:min(540px,92%);background:#08121a;padding:18px;border-radius:12px;color:#fff;position:relative}
    .pv-modal input{padding:8px 10px;border-radius:8px;border:none;background:#0a1a1f;color:#fff;font-weight:800;text-align:center}
    .pv-shake{animation:pv-shake 600ms ease}
    @keyframes pv-shake{0%{transform:translateX(0)}25%{transform:translateX(-8px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
    @media (max-width:800px){.pv-grid{grid-template-columns:repeat(5,1fr)}}
    @media (max-width:480px){.pv-grid{grid-template-columns:repeat(4,1fr)}}
  </style>
</head>
<body>

  <section id="raspadita" style="padding:56px 0;">
    <div class="pv-container">
      <header class="pv-header">
        <h2 style="font-family:Montserrat, sans-serif; font-weight:900; margin:0 0 6px;">‚ö° POWERVOLT SCRATCH CLASSIC ‚ö°</h2>
        <p style="color:var(--pv-muted); margin:0 0 18px;">Rasca tu boleto: revel√° las figuras. Si encontr√°s <strong>3 o m√°s coronas</strong>, gan√°s.</p>
      </header>

      <div class="pv-ticket" id="pvTicket">
        <div class="pv-winning-figures">
          <div class="win-title" style="font-weight:700;color:var(--pv-muted);font-size:13px">FIGURAS GANADORAS</div>
          <div class="wins">
            <div class="win-fig">üëë</div>
            <div class="win-fig">üëë</div>
            <div class="win-fig">üëë</div>
          </div>
        </div>

        <div class="pv-grid-wrap">
          <div class="pv-grid" id="pvGrid"></div>
          <canvas id="pvScratchAll" class="pv-scratch-canvas" aria-label="√Årea para rascar"></canvas>
        </div>

        <div class="pv-footer">
          <p id="pvStatus" class="pv-status">Rasca la superficie para descubrir tus figuras</p>
          <div class="pv-actions" id="pvActions" aria-hidden="true">
            <button id="pvClaimBtn" class="pv-btn pv-btn-claim" style="display:none;">Reclamar premio</button>
            <button id="pvRetryBtn" class="pv-btn pv-btn-retry" style="display:none;">Volver a intentar</button>
          </div>
        </div>
      </div>
    </div>

    <div id="pvModal" class="pv-modal" aria-hidden="true">
      <div class="pv-modal-inner">
        <button id="pvModalClose" class="pv-modal-close" aria-label="Cerrar" style="position:absolute; right:12px; top:10px; background:transparent; border:none; color:var(--pv-muted); font-size:16px; cursor:pointer;">‚úï</button>
        <h3 id="pvModalTitle">Reclamar premio</h3>
        <p id="pvModalBody">Present√° este c√≥digo en la tienda PowerVolt o contactanos por nuestras redes para canjear.</p>
        <div class="pv-modal-code-row" style="display:flex; gap:10px; margin-top:12px; justify-content:center;">
          <input id="pvModalCode" readonly />
          <button id="pvModalCopy" class="pv-btn">Copiar</button>
        </div>
      </div>
    </div>
  </section>

<script>
(function(){
  // CONFIG
  const NUM_CELLS = 30;
  const COLS = 6;
  const REQUIRED_MATCH = 3;
  const STORAGE_RESULT_KEY = 'pv_scratch_result';

  const SYMBOLS = ['üçã','üçä','üçì','‚ö°','‚≠ê','üëë'];
  const WIN_SYMBOL = 'üëë';

  // DOM
  const gridEl = document.getElementById('pvGrid');
  const canvas = document.getElementById('pvScratchAll');
  const statusEl = document.getElementById('pvStatus');
  const claimBtn = document.getElementById('pvClaimBtn');
  const retryBtn = document.getElementById('pvRetryBtn');
  const actions = document.getElementById('pvActions');
  const modal = document.getElementById('pvModal');
  const modalClose = document.getElementById('pvModalClose');
  const modalCode = document.getElementById('pvModalCode');
  const modalCopy = document.getElementById('pvModalCopy');
  const modalTitle = document.getElementById('pvModalTitle');
  const modalBody = document.getElementById('pvModalBody');
  const ticket = document.getElementById('pvTicket');

  const ctx = canvas.getContext('2d');
  const DPR = window.devicePixelRatio || 1;

  let isDrawing = false;
  let lastPos = null;
  let revealed = false;

  // HELPERS
  function todayISO(){ return new Date().toISOString().slice(0,10); }

  function saveResult(obj){
    try{
      obj.date = todayISO();
      localStorage.setItem(STORAGE_RESULT_KEY, JSON.stringify(obj));
    }catch(e){ console.warn('Storage write failed', e); }
  }

  function getStored(){
    try{
      const raw = localStorage.getItem(STORAGE_RESULT_KEY);
      if(!raw) return null;
      const obj = JSON.parse(raw);
      if(!obj || obj.date !== todayISO()) return null;
      return obj;
    }catch(e){ return null; }
  }

  // GRID
  function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
  function pickSymbolsArray(){
    const arr=[];
    for(let i=0;i<NUM_CELLS;i++){
      const r=Math.random();
      if(r < 0.12) arr.push(WIN_SYMBOL);
      else arr.push(SYMBOLS[Math.floor(Math.random()*(SYMBOLS.length-1))]);
    }
    return shuffleArray(arr);
  }
  function renderGrid(symbols){
    gridEl.innerHTML = '';
    for(let i=0;i<NUM_CELLS;i++){
      const cell = document.createElement('div');
      cell.className = 'pv-cell';
      const fig = document.createElement('div');
      fig.className = 'pv-fig';
      fig.textContent = symbols[i] || '';
      cell.appendChild(fig);
      gridEl.appendChild(cell);
    }
  }

  // CANVAS overlay
  function fitCanvasToGrid(){
    const w = gridEl.offsetWidth;
    const h = gridEl.offsetHeight;

    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';

    canvas.width = Math.max(1, Math.floor(w * DPR));
    canvas.height = Math.max(1, Math.floor(h * DPR));
    ctx.setTransform(DPR,0,0,DPR,0,0);

    canvas.style.zIndex = 20;
    canvas.style.pointerEvents = 'auto';

    drawOverlay();
  }

  function drawOverlay(){
    const w = canvas.width / DPR;
    const h = canvas.height / DPR;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // fondo metalizado
    const grad = ctx.createLinearGradient(0,0,w,h);
    grad.addColorStop(0,'#cfcfcf');
    grad.addColorStop(0.5,'#9e9e9e');
    grad.addColorStop(1,'#cfcfcf');
    ctx.fillStyle = grad;
    roundRect(ctx,0,0,w,h,10);
    ctx.fill();

    // textura ligera
    ctx.globalAlpha = 0.10;
    for(let i=0;i<40;i++){
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.fillRect(Math.random()*w, Math.random()*h, Math.random()*2+1, Math.random()*h*0.35);
    }
    ctx.globalAlpha = 1;

    // gu√≠as punteadas encima
    const cols = COLS;
    const rows = Math.ceil(NUM_CELLS / cols);
    const colW = w / cols;
    const rowH = h / rows;

    ctx.save();
    const guideColor = getComputedStyle(document.documentElement).getPropertyValue('--pv-guides') || 'rgba(0,255,102,0.22)';
    ctx.strokeStyle = guideColor.trim();
    ctx.lineWidth = Math.max(1, DPR <= 1 ? 1 : 1.25);
    ctx.setLineDash([8,6]);
    ctx.shadowColor = 'rgba(0,255,102,0.10)';
    ctx.shadowBlur = 6;

    for(let i=1;i<cols;i++){
      const x = Math.round(i * colW) + 0.5;
      ctx.beginPath();
      ctx.moveTo(x, 8);
      ctx.lineTo(x, h-8);
      ctx.stroke();
    }
    for(let r=1;r<rows;r++){
      const y = Math.round(r * rowH) + 0.5;
      ctx.beginPath();
      ctx.moveTo(8, y);
      ctx.lineTo(w-8, y);
      ctx.stroke();
    }
    ctx.shadowBlur = 0;
    ctx.setLineDash([]);
    ctx.restore();

    // texto indicativo
    ctx.fillStyle = 'rgba(255,255,255,0.92)';
    ctx.font = '700 16px Montserrat, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('RASCA AQU√ç', w/2, 28);
  }

  function roundRect(ctx,x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  function eraseAt(x,y,radius=22){
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x,y,radius,0,Math.PI*2);
    ctx.fill();
    ctx.globalCompositeOperation = 'source-over';
  }

  function computeRevealed(){
    try{
      const img = ctx.getImageData(0,0,canvas.width,canvas.height);
      const d = img.data;
      let cleared = 0;
      const step = 4 * 8;
      for(let i=3;i<d.length;i+=step) if(d[i] === 0) cleared++;
      const total = d.length / step;
      return cleared / total;
    }catch(e){
      return 0;
    }
  }

  // RESULT
  function evaluateResult(){
    const figs = Array.from(document.querySelectorAll('.pv-fig')).map(el=>el.textContent);
    const countCrowns = figs.filter(s=>s===WIN_SYMBOL).length;
    const win = countCrowns >= REQUIRED_MATCH;
    const obj = { date: todayISO(), win: win, crowns: countCrowns, symbols: figs, code: win ? generateCode() : null };
    saveResult(obj);
    return obj;
  }

  function generateCode(){
    const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789';
    let c='';
    for(let i=0;i<6;i++) c += chars[Math.floor(Math.random()*chars.length)];
    return 'PV-' + c;
  }

  // UI on finish
  function onRevealComplete(){
    if(revealed) return;
    revealed = true;
    const res = evaluateResult();
    actions.setAttribute('aria-hidden','false');

    // quitamos overlay para que se vean las figuras
    ctx.clearRect(0,0,canvas.width,canvas.height);
    canvas.style.pointerEvents = 'none';

    if(res.win){
      statusEl.innerText = `¬°Ganaste! Encontraste ${res.crowns} coronas.`;
      claimBtn.style.display = 'inline-block';
      retryBtn.style.display = 'none';
      launchConfetti();
    } else {
      statusEl.innerText = `No ganaste. Encontraste ${res.crowns} coronas. Volv√© ma√±ana.`;
      claimBtn.style.display = 'none';
      retryBtn.style.display = 'inline-block';
      ticket.classList.add('pv-shake');
      setTimeout(()=> ticket.classList.remove('pv-shake'), 700);
    }
  }

  // POINTERS
  function getPointer(e){
    const rect = canvas.getBoundingClientRect();
    if(e.touches && e.touches[0]) return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }

  function pointerDown(e){
    const stored = getStored();
    if(stored){
      // si ya jug√≥ hoy, bloquear
      alert('Ya jugaste hoy. Volv√© ma√±ana.');
      return;
    }
    isDrawing = true;
    lastPos = getPointer(e);
    eraseAt(lastPos.x, lastPos.y, 26);
    e.preventDefault();
  }

  function pointerMove(e){
    if(!isDrawing) return;
    const p = getPointer(e);
    const dist = Math.hypot(p.x - lastPos.x, p.y - lastPos.y);
    const steps = Math.ceil(dist / 4);
    for(let i=0;i<steps;i++){
      const x = lastPos.x + (p.x - lastPos.x)*(i/steps);
      const y = lastPos.y + (p.y - lastPos.y)*(i/steps);
      eraseAt(x,y,20);
    }
    lastPos = p;
    const pct = computeRevealed();
    if(pct > 0.5) onRevealComplete();
    e.preventDefault();
  }

  function pointerUp(e){
    isDrawing = false;
    lastPos = null;
    const pct = computeRevealed();
    if(pct > 0.5) onRevealComplete();
  }

  // CONFETTI
  function launchConfetti(){
    const canvasC = document.createElement('canvas');
    canvasC.id = 'pvConf';
    canvasC.style.position='fixed'; canvasC.style.left='0'; canvasC.style.top='0';
    canvasC.style.width='100%'; canvasC.style.height='100%'; canvasC.style.pointerEvents='none'; canvasC.style.zIndex='9999';
    document.body.appendChild(canvasC);
    const cctx = canvasC.getContext('2d');
    canvasC.width = window.innerWidth * DPR;
    canvasC.height = window.innerHeight * DPR;
    cctx.setTransform(DPR,0,0,DPR,0,0);
    const parts = []; const cols = ['#00ff66','#00baff','#ff6a00','#ffffff'];
    for(let i=0;i<120;i++) parts.push({ x:Math.random()*window.innerWidth, y:-Math.random()*200, vx:(Math.random()-0.5)*4, vy:2+Math.random()*6, size:6+Math.random()*8, col:cols[Math.floor(Math.random()*cols.length)], rot:Math.random()*360 });
    let running = true;
    function frame(){
      cctx.clearRect(0,0,canvasC.width, canvasC.height);
      for(const p of parts){
        p.x += p.vx; p.y += p.vy; p.vy *= 1.005;
        cctx.save();
        cctx.translate(p.x, p.y);
        cctx.rotate(p.rot * Math.PI/180);
        cctx.fillStyle = p.col;
        cctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
        cctx.restore();
      }
      if(running) requestAnimationFrame(frame);
    }
    frame();
    setTimeout(()=> { running=false; setTimeout(()=> canvasC.remove(), 800); }, 3200);
  }

  // BUTTONS / MODAL
  claimBtn.addEventListener('click', ()=> {
    const stored = getStored();
    if(!stored || !stored.win) return;
    modal.setAttribute('aria-hidden','false');
    modalCode.value = stored.code || generateCode();
    modalTitle.innerText = 'Premio ganado';
    modalBody.innerText = 'Mostranos este codigo en nuestra tienda asociada o contactanos por nuestras redes para canjear.';
  });

  retryBtn.addEventListener('click', ()=> {
    const stored = getStored();
    if(stored){
      alert('Solo ten√©s 1 intento por d√≠a. Volv√© ma√±ana para jugar de nuevo.');
      return;
    }
    // si no hay stored (no jug√≥ hoy), reiniciamos
    revealed = false;
    const symbols = pickSymbolsArray();
    renderGrid(symbols);
    fitCanvasToGrid();
    drawOverlay();
    canvas.style.pointerEvents = 'auto';
    statusEl.innerText = 'Rasca la superficie para descubrir tus figuras';
    claimBtn.style.display = 'none';
    retryBtn.style.display = 'none';
    actions.setAttribute('aria-hidden','true');
  });

  modalClose.addEventListener('click', ()=> modal.setAttribute('aria-hidden','true'));
  modalCopy.addEventListener('click', ()=> {
    navigator.clipboard.writeText(modalCode.value).then(()=> {
      modalCopy.innerText = 'Copiado';
      setTimeout(()=> modalCopy.innerText = 'Copiar', 1200);
    }).catch(()=> {
      modalCopy.innerText = 'Error';
      setTimeout(()=> modalCopy.innerText = 'Copiar', 1200);
    });
  });

  // INIT
  function init(){
    const stored = getStored();
    if(stored){
      // si jug√≥ hoy mostramos exactamente su resultado guardado
      renderGrid(stored.symbols || pickSymbolsArray());
    } else {
      renderGrid(pickSymbolsArray());
    }

    setTimeout(()=>{
      fitCanvasToGrid();
      // Si jug√≥ hoy: revelado autom√°tico (sin overlay) y bloqueo
      if(stored){
        revealed = true;
        ctx.clearRect(0,0,canvas.width,canvas.height); // quitamos overlay
        canvas.style.pointerEvents = 'none';
        actions.setAttribute('aria-hidden','false');

        if(stored.win){
          statusEl.innerText = `Ya jugaste hoy. Ganaste (${stored.crowns} coronas).`;
          claimBtn.style.display = 'inline-block';
          retryBtn.style.display = 'inline-block';
          if(!stored.code) stored.code = generateCode();
          saveResult(stored);
        } else {
          statusEl.innerText = `Ya jugaste hoy. No ganaste. Encontraste ${stored.crowns} coronas.`;
          claimBtn.style.display = 'none';
          retryBtn.style.display = 'inline-block';
        }
      } else {
        drawOverlay();
        addCanvasListeners();
      }
    }, 120);
  }

  function addCanvasListeners(){
    // a√±adimos listeners una sola vez
    canvas.addEventListener('mousedown', pointerDown);
    window.addEventListener('mousemove', pointerMove);
    window.addEventListener('mouseup', pointerUp);
    canvas.addEventListener('touchstart', pointerDown, {passive:false});
    window.addEventListener('touchmove', pointerMove, {passive:false});
    window.addEventListener('touchend', pointerUp);
    window.addEventListener('resize', ()=> setTimeout(fitCanvasToGrid,120));
  }

  // start
  init();

})();
</script>

</body>
</html>
